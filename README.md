# 厦门理工学院PFA战队单目相机雷达站算法开源（含机器人、装甲板识别模型）
 **【已更新最新的串口通信协议，国赛即插即用！！！】** 


【全场透视！979.6s有效标记定位！｜厦门理工学院雷达机器人研发方案分享】 https://www.bilibili.com/video/BV1jD421g7ab/


【RoboMaster2024青年工程师大会｜厦门理工学院雷达视觉算法设计思路分享】 https://www.bilibili.com/video/BV1uJ4m137uh/

#### 简述

基于此算法，使用 **任意单目相机** 和 **任意运算端** ，即可实现 **雷达站的所有功能** ，主要功能如下：
1. 机器人精确定位
2. 视野盲区预测（辽科雷达方案优化）
3. 标记进度显示
4. 自主发动双倍易伤
5. 裁判系统双向通信
6. 支持USB相机和海康相机

#### 效果展示

![全场高亮](images/image4.jpg)
![南部雷达](images/image1.jpg)
![双倍易伤](images/image2.png)
![全国雷达排名第一](images/%E5%85%A8%E5%9B%BD%E7%AC%AC%E4%B8%80.JPG)

#### 配置环境
1.  python3.9
2.  pip install -r requirements.txt 
3.  如需加速模型推理，请安装tensorrt版本8.6.1（安装教程网上有）
4.  安装好tensorrt后，运行onnx2engine.py,模型转换完成后，修改main.py 573行，更换为engine模型

#### 硬件要求
1. 海康工业相机/USB直驱相机
2. USB串口（另一头需接裁判系统user串口）
3. 有GPU的运算端，推荐RTX3060以上
4. 推荐配置：相机MV-CS060-10UC-PRO（USB款），镜头5-12ｍｍ（6ｍｍ最佳）
![输入图片说明](images/image6.JPG)


#### 标定指南
1. 每场比赛开始前，需对雷达进行标定，选择己方阵营（test模式只能为蓝方），calibration.py 374行
2. 将相机视角调节合适后，点击“开始标定”
3. 依次点击相机视图和地图视图 **地面** 对应对应的四组、八个点（白色）后，点击切换高度
4. 依次点击相机视图和地图视图 **R型高地** 对应对应的四组、八个点（绿色）后，点击切换高度
5. 依次点击相机视图和地图视图 **环型高地** 对应对应的四组、八个点后（蓝色），点击保存计算
![标定演示](images/calibration.JPG)


#### 运行指南（标定完成后）
1. 更改main.py 580行的串口名
2. 修改运行模式---'test':测试模式,'hik':海康相机,'video':USB相机（videocapture）main.py 582行，默认为test
3. 修改己方阵营，test模式只能为蓝方，main.py 17行
4. 运行main.py文件，出现如下图所示则运行成功（标记进度全为-1表示没有连接到裁判系统）
![运行图例](images/image3.JPG)
5. 在云台手端，切换飞镖锁定目标触发双倍易伤
6. 如果运行帧率太低，1fps左右，考虑是torch或者onnx没有安装GPU版本，如果不行，请转换为trt模型加速推理



#### 注意事项
1. 不仅可以tensorrt加速，理论上openvino也可以
2. 可以修改多个机器人都进行盲区预测
3. 遇到问题联系我，QQ：2728615481
4. 如果对你有帮助的话帮忙点个star

#### 已知问题及解决方法
1. 使用MV-CA016-10UC相机，Gain值设置失败，可以降低main.py 268行Gain的数值，或者直接注释掉该行


